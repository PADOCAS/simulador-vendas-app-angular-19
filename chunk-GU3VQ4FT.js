import{a as ue}from"./chunk-MNPQJSQR.js";import{a as ce}from"./chunk-GOSEDUVX.js";import{a as se}from"./chunk-5GR2HCL7.js";import{b as A,d as N,f as me}from"./chunk-ZZRUWSD2.js";import{C as K,D as X,E as Y,F as Z,G as ee,H as te,I as ie,da as oe,ea as re,f as U,fa as ae,g as s,ga as ne,h as O,ha as de,i as D,j as L,ja as le,k,l as j,n as G,o as R,p as B,q as Q,t as $,u as W,w as z,x as H,z as J}from"./chunk-QGSPP7SH.js";import{$b as w,Db as p,Fc as T,Gc as V,Hb as i,Ib as t,Jb as g,Nb as y,Qb as E,Wb as x,Xb as P,Yb as I,ac as o,bb as d,cb as v,cc as q,d as _,na as C,nb as b,oa as h,s as M,sb as c,yb as m}from"./chunk-SVLTXY3Q.js";var pe=["inputCategoria"];function fe(r,l){r&1&&(i(0,"div")(1,"mat-form-field",23)(2,"mat-label"),o(3,"Id"),t(),g(4,"input",24),t()())}function ve(r,l){r&1&&(i(0,"mat-error"),o(1,"Informe se o produto est\xE1 ativo"),t())}function ge(r,l){r&1&&(i(0,"mat-error"),o(1,"Descri\xE7\xE3o \xE9 "),i(2,"strong"),o(3,"requerida"),t()())}function Ce(r,l){r&1&&(i(0,"mat-error"),o(1,"Descri\xE7\xE3o deve ter no m\xEDnimo 3 caracteres"),t())}function he(r,l){r&1&&(i(0,"mat-error"),o(1,"Unidade Medida \xE9 "),i(2,"strong"),o(3,"requerida"),t()())}function Ee(r,l){r&1&&(i(0,"mat-error"),o(1,"Unidade Medida deve ter no m\xEDnimo 2 caracteres"),t())}function _e(r,l){if(r&1&&(i(0,"mat-option",7)(1,"mat-icon"),o(2,"category"),t(),o(3),t()),r&2){let e=l.$implicit;m("value",e),d(3),q(" ","("+e.id+") "+e.nome," ")}}function Se(r,l){r&1&&(i(0,"mat-error"),o(1,"Categoria \xE9 "),i(2,"strong"),o(3,"requerida"),t()())}function Fe(r,l){r&1&&(i(0,"mat-error"),o(1,"Selecione uma Categoria v\xE1lida"),t())}function qe(r,l){if(r&1&&(i(0,"mat-option",7)(1,"mat-icon"),o(2,"business"),t(),o(3),t()),r&2){let e=l.$implicit;m("value",e.id),d(3),q(" ","("+e.id+") "+e.razaoSocial," ")}}function Me(r,l){r&1&&(i(0,"mat-error"),o(1,"Fornecedor \xE9 "),i(2,"strong"),o(3,"requerido"),t()())}function be(r,l){r&1&&(i(0,"mat-error"),o(1,"Pre\xE7o unit\xE1rio \xE9 "),i(2,"strong"),o(3,"requerido"),t()())}function ye(r,l){r&1&&(i(0,"mat-error"),o(1,"Quantidade Estoque \xE9 "),i(2,"strong"),o(3,"requerida"),t()())}var He=(()=>{class r{constructor(e,a,n,u,f,S){this.produtosService=e,this.fornecedoresService=a,this.categoriasService=n,this.form=u,this.router=f,this.routeActive=S,this.showLoading=!1,this.listFornecedor=null,this.listCategoria=null,this.produtoForm=this.form.group({id:[null],fornecedorId:[null,s.required],categoria:[null,[s.required,this.categoriaValidaValidator()]],unidadeMedida:["",[s.required,s.minLength(2)]],precoUnitario:[null,[s.required,s.min(0)]],qtdeEstoque:[null,[s.required,s.min(0)]],ativo:[!0,[s.required]],descricao:["",[s.required,s.minLength(3)]]}),this.displayCategoria=F=>F?`(${F.id}) ${F.nome}`:""}ngOnInit(){this.carregarCategorias().then(()=>{this.listCategoria!==null&&this.listCategoria.length>0&&(this.filteredCategoriaOptions=this.listCategoria.slice()),this.carregarFornecedores().then(()=>{this.routeActive!==void 0&&this.routeActive!==null&&this.routeActive.snapshot!==void 0&&this.routeActive.snapshot!==null&&this.routeActive.snapshot.paramMap!==void 0&&this.routeActive.snapshot.paramMap!==null&&this.routeActive.snapshot.paramMap.get("id")!==void 0&&this.routeActive.snapshot.paramMap.get("id")!==null&&this.produtosService.pegar(Number(this.routeActive.snapshot.paramMap.get("id"))).subscribe(e=>{if(e!=null){let a=e;this.produtoForm.setValue({id:a.id,fornecedorId:a.fornecedorId||null,categoria:a.categoria||null,unidadeMedida:a.unidadeMedida,precoUnitario:a.precoUnitario,qtdeEstoque:a.qtdeEstoque,ativo:a.ativo!==null&&a.ativo!==void 0?a.ativo:!0,descricao:a.descricao}),this.produtoForm.get("id")?.disable()}}),window.comp=this},e=>{console.log("Erro ao carregar Fornecedores: "+e)})},e=>{console.log("Erro ao carregar Categorias: "+e)})}carregarCategorias(){return _(this,null,function*(){this.listCategoria=yield this.categoriasService.getCategorias().toPromise()})}carregarFornecedores(){return _(this,null,function*(){this.listFornecedor=yield this.fornecedoresService.getFornecedores().toPromise()})}filterCategoria(){let e=this.inputCategoria.nativeElement.value?.toLowerCase()||"";this.filteredCategoriaOptions=this.listCategoria?.filter(a=>a.nome.toLowerCase().includes(e)||a.id.toString().includes(e))||[]}onCategoriaSelected(e){this.produtoForm.controls.categoria.setValue(e),this.produtoForm.controls.categoria.markAsTouched(),this.produtoForm.updateValueAndValidity()}categoriaValidaValidator(){return e=>{let a=e.value;return a&&typeof a=="object"&&"id"in a&&"nome"in a?(e.markAsTouched(),null):{invalidCategoria:!0}}}onSubmit(){this.onSave(this.convertFormBuilderGroupToProduto())}convertFormBuilderGroupToProduto(){this.produtoForm.get("id")?.enable();let e=this.produtoForm.value;return this.produtoForm.get("id")?.disable(),{id:e.id??0,fornecedorId:e.fornecedorId??0,categoria:e.categoria||null,unidadeMedida:e.unidadeMedida||"",precoUnitario:e.precoUnitario!==null&&e.precoUnitario!==void 0?e.precoUnitario:null,qtdeEstoque:e.qtdeEstoque!==null&&e.qtdeEstoque!==void 0?e.qtdeEstoque:null,ativo:e.ativo!==null&&e.ativo!==void 0?e.ativo:!0,descricao:e.descricao||""}}onSave(e){return _(this,null,function*(){this.showLoading=!0,yield M(this.produtosService.salvar(e)),this.showLoading=!1,this.router.navigate(["/produtos"])})}cancelar(){this.router.navigate(["/produtos"])}static{this.\u0275fac=function(a){return new(a||r)(v(se),v(ce),v(ue),v(B),v(N),v(A))}}static{this.\u0275cmp=b({type:r,selectors:[["app-cad-produto"]],viewQuery:function(a,n){if(a&1&&x(pe,5),a&2){let u;P(u=I())&&(n.inputCategoria=u.first)}},decls:65,vars:23,consts:[["inputCategoria",""],["auto","matAutocomplete"],["novalidate","",3,"ngSubmit","formGroup"],[4,"ngIf"],[1,"container"],[2,"display","flex","flex-direction","column","justify-content","center"],["formControlName","ativo"],[3,"value"],[1,"container",2,"display","flex"],[1,"item",2,"flex","3"],["matInput","","formControlName","descricao"],[1,"item",2,"flex","1"],["matInput","","formControlName","unidadeMedida"],[1,"item"],["type","text","matInput","","placeholder","Selecione uma Categoria...",3,"input","focus","required","formControl","matAutocomplete"],[3,"optionSelected","displayWith"],[3,"value",4,"ngFor","ngForOf"],["formControlName","fornecedorId","placeholder","Selecione um fornecedor..."],["mask","separator.2","thousandSeparator",".","decimalMarker",",","min","0","matInput","","formControlName","precoUnitario"],["mask","separator.0","min","0","thousandSeparator",".","matInput","","formControlName","qtdeEstoque"],["mat-raised-button","","color","primary","type","submit",2,"margin-right","8px !important",3,"disabled"],["type","button","mat-raised-button","","color","primary",3,"click"],[3,"visible"],[1,"item-20"],["matInput","","formControlName","id"]],template:function(a,n){if(a&1){let u=y();i(0,"mat-card")(1,"mat-card-header")(2,"mat-card-title"),o(3,"Produto"),t()(),i(4,"mat-card-content")(5,"form",2),E("ngSubmit",function(){return C(u),h(n.onSubmit())}),i(6,"div"),c(7,fe,5,0,"div",3),i(8,"div",4)(9,"mat-label",5),o(10,"Ativo"),t(),i(11,"mat-radio-group",6)(12,"mat-radio-button",7),o(13,"Sim"),t(),i(14,"mat-radio-button",7),o(15,"N\xE3o"),t()(),c(16,ve,2,0,"mat-error"),t(),i(17,"div",8)(18,"mat-form-field",9)(19,"mat-label"),o(20,"Descri\xE7\xE3o"),t(),g(21,"input",10),c(22,ge,4,0,"mat-error")(23,Ce,2,0,"mat-error"),t(),i(24,"mat-form-field",11)(25,"mat-label"),o(26,"Unidade Medida"),t(),g(27,"input",12),c(28,he,4,0,"mat-error")(29,Ee,2,0,"mat-error"),t()(),i(30,"div",4)(31,"mat-form-field",13)(32,"mat-label"),o(33,"Categoria"),t(),i(34,"input",14,0),E("input",function(){return C(u),h(n.filterCategoria())})("focus",function(){return C(u),h(n.filterCategoria())}),t(),i(36,"mat-autocomplete",15,1),E("optionSelected",function(S){return C(u),h(n.onCategoriaSelected(S.option.value))}),c(38,_e,4,2,"mat-option",16),t(),c(39,Se,4,0,"mat-error")(40,Fe,2,0,"mat-error"),t(),i(41,"mat-form-field",13)(42,"mat-label"),o(43,"Fornecedor"),t(),i(44,"mat-select",17)(45,"mat-option",7),o(46," Selecione um Fornecedor... "),t(),c(47,qe,4,2,"mat-option",16),t(),c(48,Me,4,0,"mat-error"),t()()(),i(49,"div",4)(50,"mat-form-field",13)(51,"mat-label"),o(52,"Pre\xE7o Unit\xE1rio"),t(),g(53,"input",18),c(54,be,4,0,"mat-error"),t(),i(55,"mat-form-field",13)(56,"mat-label"),o(57,"Quantidade Estoque"),t(),g(58,"input",19),c(59,ye,4,0,"mat-error"),t()(),i(60,"button",20),o(61," Salvar "),t(),i(62,"button",21),E("click",function(){return C(u),h(n.cancelar())}),o(63," Cancelar "),t()()(),g(64,"app-loading-bar",22),t()}if(a&2){let u,f=w(37);d(5),m("formGroup",n.produtoForm),d(2),m("ngIf",((u=n.produtoForm.get("id"))==null?null:u.value)!==null),d(5),m("value",!0),d(2),m("value",!1),d(2),p(n.produtoForm.controls.ativo.hasError("required")?16:-1),d(6),p(n.produtoForm.controls.descricao.hasError("required")?22:-1),d(),p(n.produtoForm.controls.descricao.hasError("minlength")?23:-1),d(5),p(n.produtoForm.controls.unidadeMedida.hasError("required")?28:-1),d(),p(n.produtoForm.controls.unidadeMedida.hasError("minlength")?29:-1),d(5),m("required",!0)("formControl",n.produtoForm.controls.categoria)("matAutocomplete",f),d(2),m("displayWith",n.displayCategoria),d(2),m("ngForOf",n.filteredCategoriaOptions),d(),p(n.produtoForm.controls.categoria.hasError("required")?39:-1),d(),p(n.produtoForm.controls.categoria.hasError("invalidCategoria")?40:-1),d(5),m("value",null),d(2),m("ngForOf",n.listFornecedor),d(),p(n.produtoForm.controls.fornecedorId.hasError("required")?48:-1),d(6),p(n.produtoForm.controls.precoUnitario.hasError("required")?54:-1),d(5),p(n.produtoForm.controls.qtdeEstoque.hasError("required")?59:-1),d(),m("disabled",n.produtoForm.invalid),d(4),m("visible",n.showLoading)}},dependencies:[Q,L,U,O,D,R,k,j,G,le,W,X,te,ee,Y,Z,z,J,K,H,oe,re,$,ae,ie,ne,de,V,me,T],styles:["[_nghost-%COMP%]     mat-radio-button div.mat-internal-form-field>label.mdc-label{padding-left:0!important;margin-top:1px!important}.mat-mdc-card-content[_ngcontent-%COMP%]{padding-bottom:16px}"]})}}return r})();export{He as CadProdutoComponent};
